{% extends 'base_admin.html.twig' %}

{% block content %}
        <div class="row" style="margin-top:20px">
            <div class="col s12">
                <a href="{{  url('admin_user_add') }}" class="valign-wrapper"><i class="material-icons valign">add</i>Voeg een consultant toe</a>
            </div>
        </div>
    {% for flash_message in app.session.flashBag.get('notice') %}
        <div id="card-alert" class="card green succes-entity" style="display:none">
            <div class="card-content white-text valign-wrapper">
                <i class="material-icons valign">done</i>&nbsp;<span>{{ flash_message }}</span>
            </div>
        </div>
    {% endfor %}
    {% for flash_message in app.session.flashBag.get('error') %}
        <div id="card-alert" class="card red succes-entity" style="display:none">
            <div class="card-content white-text valign-wrapper">
                <i class="material-icons valign">warning</i>&nbsp;<span>{{ flash_message }}</span>
            </div>
        </div>
    {% endfor %}

    {% if users %}
        <table class="highlight responsive-table">
            <thead>
            <tr>
                <th data-field="userImage" width="65"></th>
                <th data-field="userName">Naam</th>
                <th data-field="userStatus">Rollen</th>
                <th data-field="userStatus">Status</th>
                <th data-field="actions" width="90"></th>
            </tr>
            </thead>

            <tbody>
            {% for user in users %}
                {% if user.passwordRequestedAt is null %}
                    {% set disablereset = false %}
                {% elseif date(user.passwordRequestedAt) > date('-2hours') %}
                    {% set disablereset = true %}
                {% else %}
                    {% set disablereset = false %}
                {% endif %}
                <tr>
                    <td><img src="{{ asset('img/profile/' ~ user.personalia.profileAvatarName) }}" alt="" class="circle" style="max-width:55px"></td>
                    <td>{{ user.personalia.firstName }} {{ user.personalia.lastName }}<br/><em>{{ user.personalia.placeOfResidence }}</em></td>
                    <td>{% set userRole = false %}
                        {% for role in user.roles %}
                            {% if role == "ROLE_SUPER_ADMIN" %}
                                {% set userRole = "Beheerder" %}
                            {% elseif role == "ROLE_ADMIN" and not userRole %}
                                {% set userRole = "Manager" %}
                            {% elseif role == "ROLE_USER" and not userRole %}
                                {% set userRole = "Consultant" %}
                            {% elseif role == "ROLE_ZZP" and not userRole %}
                                {% set userRole = "ZZP" %}
                            {% endif %}
                        {% endfor %}
                        {{ userRole }}
                    </td>
                    <td>{% if user.enabled == 1 %}
                            <a href="{{ url('admin_user_toggle_active',{'userId' : user.id }) }}" alt="Dectiveren" class="valign-wrapper"><i class="material-icons valign">lock_outline</i> Actief</a>
                        {% else %}
                            <a href="{{ url('admin_user_toggle_active',{'userId' : user.id }) }}" alt="Activeren" class="valign-wrapper"><i class="material-icons valign">lock_open</i> Inactief</a>
                        {% endif %}</td>
                    <td>
                        <a href="#" alt="Wachtwoord reset" class="reset-button-{{ user.id }} {% if disablereset %}grey-text" style="pointer-events: none{% endif %}">
                            <i class="material-icons">settings_backup_restore</i>
                        </a>
                        <a href="{{ url('admin_user_edit',{'userId' : user.id }) }}" alt="Bewerken">
                            <i class="material-icons">edit</i>
                        </a>
                        <a href="#" class="delete-button-{{ user.id }}" alt="Verwijderen">
                            <i class="material-icons">delete</i>
                        </a>
                    </td>
                </tr>
                    <div id="card-alert" class="card red delete-entity-{{ user.id }}" style="display:none">
                        <div class="card-content white-text valign-wrapper">
                            <i class="material-icons valign">warning</i>&nbsp;
                            <span>Weet je zeker dat je {{ user.personalia.firstName }} {{ user.personalia.lastName }} wilt verwijderen?
                                <strong><a class="white-text" href="{{ url('admin_user_delete',{'userId' : user.id}) }}">Ja, verwijder.</a></strong>
                            </span>
                        </div>
                    </div>
                    <div id="card-alert" class="card red reset-entity-{{ user.id }}" style="display:none">
                        <div class="card-content white-text valign-wrapper">
                            <i class="material-icons valign">warning</i>&nbsp;
                            <span>Weet je zeker dat je het wachtwoord van {{ user.personalia.firstName }} {{ user.personalia.lastName }} wilt resetten?</span><form method="post" action="{{ path('fos_user_resetting_send_email') }}"><input class="linkButton" type="submit" value="Ja, reset wachtwoord.">
                                    <input type="hidden" value="{{ user.username }}" name="username">
                                    <input type="hidden" value="1" name="admin">
                                    </form>

                        </div>
                    </div>
            {% endfor %}
            </tbody>
        </table>
    {% else %}
        <div class="row">
            <div class="col s12"><h3>Geen consultants gevonden.</h3></div>
        </div>
    {% endif %}

{% endblock %}